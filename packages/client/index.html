<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        pointer-events: none;
      }
      #__vconsole{
        pointer-events : auto;
      }
    </style>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no"
    />

    <!-- PWA primary color -->
    <meta name="description" content="Connected Worlds for Everyone" />
    <meta name="monetization" content="<%- paymentPointer %>" data-react-helmet="true" />
    <title><%- title %></title>
    <link rel="apple-touch-icon" sizes="180x180" href="<%- appleTouchIcon %>" data-react-helmet="true" />
    <link rel="icon" type="image/png" sizes="32x32" href="<%- favicon32px %>" data-react-helmet="true" />
    <link rel="icon" type="image/png" sizes="16x16" href="<%- favicon16px %>" data-react-helmet="true" />
    <link rel="manifest" href="<%- webmanifestLink %>" data-react-helmet="true" />
    <!-- <link href="http//://fonts.cdnfonts.com/css/arial-rounded-mt-bold" rel="stylesheet"> -->
    <script type="text/javascript" src="https://cdn.bootcss.com/vConsole/3.3.0/vconsole.min.js"></script>
    <script src="https://res2.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
    <script>
      var global = globalThis
      var exports = { __esModule: true }
    </script>
    <script src="https://cdn.bootcss.com/PreloadJS/1.0.1/preloadjs.js"></script>
    <script>
      const startPreLoad = () => {
        let manifest = [
          { src: "https://xr-resources.yee.link/bgyModel/BGYNew.glb" },
          { src: "https://xr-resources.yee.link/BGYvideo/bgyBgm.mp3" },
          { src: "https://xr-resources.yee.link/bgyModel/TimeLine.glb" },
          { src: "https://xr-resources.yee.link/bgyModel/BiGuiYuan_Card.glb" },
          { src: "https://xr-resources.yee.link/bgyModel/BiGuiYuan_CongBao.glb" },
          { src: "https://xr-resources.yee.link/bgyModel/sky.glb" },
        ]
        for (let i = 1; i <= 150; i++) {
          manifest.push({ src: `https://xr-resources.yee.link/BGYAnimateTrans/image-${`${i}`.padStart(3, '0')}.jpeg` })
        }
        if (createjs && createjs.LoadQueue) {
          let preload = new createjs.LoadQueue(true)
          preload.addEventListener("fileload", () => {
            console.log('所需资源正在逐一预加载')
          })
          preload.addEventListener('complete', () => {
            console.log('预加载任务已完成')
          })
          console.log('资源文件开始预加载===================>')
          preload.loadManifest(manifest)
        }
      }
      const href = window.location.href
      if(href.includes('/bgyLogin')) {
        setTimeout(function(){startPreLoad();}, 15000)
      }
      function docReady(fn) {
        // see if DOM is already available
        if (document.readyState === "complete" || document.readyState === "interactive") {
            // call on next available tick
            setTimeout(fn, 1);
        } else {
            document.addEventListener("DOMContentLoaded", fn);
        }
      }
      var audiosWeWantToUnlock = []
      function unlockAudio() {
        audiosWeWantToUnlock.push(new Audio('https://xr-resources.yee.link/BGYvideo/%E6%8A%95%E7%A5%A8%E5%8C%BA%E5%BC%95%E5%AF%BC%E6%8A%95%E7%A5%A8.mp3'))
        audiosWeWantToUnlock.push(new Audio('https://xr-resources.yee.link/BGYvideo/%E6%8A%95%E7%A5%A8%E5%8C%BA%E6%B8%A9%E9%A6%A8%E6%8F%90%E7%A4%BA.mp3'))
        audiosWeWantToUnlock.push(new Audio('https://xr-resources.yee.link/BGYvideo/%E6%8A%95%E7%A5%A8%E5%8C%BA%E5%BC%95%E5%AF%BC%E7%95%99%E8%A8%80.mp3'))
        audiosWeWantToUnlock.push(new Audio('https://xr-resources.yee.link/BGYvideo/%E6%8A%BD%E5%A5%96%E5%8C%BA%20%E7%8E%AF%E8%8A%82%E4%BB%8B%E7%BB%8D.mp3'))
        audiosWeWantToUnlock.push(new Audio('https://xr-resources.yee.link/BGYvideo/%E6%8A%BD%E5%A5%96%E5%8C%BA%E6%AC%A1%E6%97%A5%E5%8F%AC%E5%9B%9E.mp3'))
        audiosWeWantToUnlock.push(new Audio('https://xr-resources.yee.link/BGYvideo/%E5%8F%82%E8%A7%82%E5%8C%BA%E6%AC%A2%E8%BF%8E%E8%AF%AD.mp3'))
        audiosWeWantToUnlock.push(new Audio('https://xr-resources.yee.link/BGYvideo/%E5%8F%82%E8%A7%82%E5%8C%BA%E5%88%9B%E6%96%B0%E8%8A%82%E4%BB%8B%E7%BB%8D.mp3'))
        if(audiosWeWantToUnlock) {
          for(let audio of audiosWeWantToUnlock) {
           audio.play()
           audio.pause()
           audio.currentTime = 0
          }
        }
        audiosWeWantToUnlock = null 
        document.body.removeEventListener('click', unlockAudio)
        document.body.removeEventListener('touchstart', unlockAudio)
      }
      if(href.includes('debug')){
        docReady(function(){
          // 初始化
          var vConsole = new VConsole();
          console.log('Hello world');
        })
      }
       //where earlier you did:
       docReady(function(){
          document.body.addEventListener('click', unlockAudio);
          document.body.addEventListener('touchstart', unlockAudio);
       })
    </script>
  </head>

  <body>
    <div id="loginroot"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script type="module" src="/pwabuilder-sw-register.js"></script>
    <canvas id='engine-renderer-canvas' style='z-index: -1; width: 100%; height: 100%; position: fixed; -webkit-user-select: none; pointer-events: auto; user-select: none'></canvas>
  </body>
</html>